<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>用户首页</title>
    <link th:href="@{/bootstrap/css/bootstrap.css}" rel="stylesheet"/>
    <link th:href="@{/bootstrap/css/bootstrap-theme.css}" rel="stylesheet"/>
    <link th:href="@{/css/mycss.css}" rel="stylesheet"/>
</head>

<body>

<div class="container">
    <div class="panel panel-default">
        <!-- Default panel contents -->
        <div class="panel-heading">文章列表</div>
        <div class="panel-body">



            <div class="col-lg-5 mytest" style="float: right">
                <div class="input-group">
                            <span class="input-group-btn">
                    <button class="btn btn-success" type="button" onclick="window.location.reload()">刷新</button>
                </span>
                    <input type="text" id ="columnInfo" class="form-control" placeholder="搜索">
                    <span class="input-group-btn">
                    <button class="btn btn-default" type="button" onclick="f()">Go!</button>
                </span>
                </div>

            </div>

         <div class="mytest"><p><a class="btn btn-primary btn-default" th:href="@{/article}" role="button">首页</a></p>
             <p><a class="btn btn-default " th:href="@{/admin/write}" role="button">写博客</a></p>
         <p><a class="btn btn-default "  th:href="@{/admin/changePwd}" role="button">修改密码</a></p>
         <p><a class="btn  btn-default "  th:href="@{/admin/logout}" role="button">注销用户</a></p>

         </div>


        </div>




        <table id="dataTable"  class="table t1" style=" width: 99%;">
            <thead>


            <tr class="info">
                <td>编号</td>
                <td>标题</td>
                <td>摘要</td>
                <td>发表时间</td>
                <td>用户</td>
                <td style="text-align: center" colspan="2">操作</td>
            </tr>

            </thead>

            <tbody>
                <tr th:each="articles:${articles}">
                    <td data-type='data'  id="data-0" class="a1 ui-jqgrid ui-widget-content" th:text="${articles.id}"></td>
                    <td data-type='data'  id="data-0" class="a1 ui-jqgrid ui-widget-content" th:text="${articles.title}"></td>
                    <td data-type='data'  id="data-0" class="a1 ui-jqgrid ui-widget-content" th:text="${articles.summary}"></td>
                    <td data-type='data'  id="data-0" class="a1 ui-jqgrid ui-widget-content" th:text="${articles.date}"></td>
                    <td data-type='data'  id="data-0" class="a1 ui-jqgrid ui-widget-content" th:text="${articles.user}"></td>
                    <td><a th:href="@{'/admin/update/'+${articles.id}}">修改</a></td>
                    <td><a th:href="@{'/admin/delete/'+${articles.id}}">删除</a></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>


<script th:href="@{/js/jquery-3.2.1.min.js}" type="text/javascript"></script>
<script th:href="@{/bootstrap/js/bootstrap.js}"></script>
<script th:href="@{/js/myjs.js}"></script>
<script>
    var tableCache = {};

    /**
     * 模糊查找
     * 指定table中是否存在指定字符，存在则改变颜色，不存在则隐藏，如果字符为空，这显示所有
     * @param {} find 查找数据
     * @param {} tableId 要操作标的id
     * @param {} callBack 回调函数，当find为控制，指定执行方法，
     *           如果callBack==undefind||callBack==null时，显示所有行，
     */
    function f() {
        var find = document.getElementById("columnInfo").value;
        SearchTable(find, "dataTable");
    }
    function SearchTable(find, tableId, callBack, isCache) {
        isCache = isCache || true;
        find = find.replace(" ", "");
        var table = document.getElementById(tableId);
        var tbody = table.getElementsByTagName("tbody")[0];
        var bodyInnerHTML = isCache == false || tableCache[tableId] == undefined || tableCache[tableId] == "" ?
            tbody.innerHTML.replace(/[\r\n\t]/g, '').replace(/[>]\s*[<]/g, "><").replace(/["]/g, "\"").replace(/[']/g, "\'") :
            tableCache[tableId];
        if (find == "") {
            tbody.innerHTML = bodyInnerHTML;
            if (callBack != null) {
                callBack();
            }
            return;
        }
        var inerArry = bodyInnerHTML.split('</tr><tr');
        for (var i = 0; i < inerArry.length; i++) {
            var iner = inerArry[i];
            var regex = new RegExp("([>](\\s?[^<>]*" + find + "[^<>]*\\s?)+[<])");
            var tr = "";
            if (regex.test(iner)) {
                //显示该列
                tr="<tr ";
                //设置该列颜色
                //分组匹配到需要的数据，然后进行替换
                inerArry[i] = iner.replace(RegExp.$1, RegExp.$1.replace(find, "<span class='searchSpan'>" + find + "</span>"));
            } else {
                tr = "<tr style='display:none'";
            }
            inerArry[i] = inerArry[i].indexOf("<tr") >= 0 ? inerArry[i].replace("<tr", tr) : (tr + inerArry[i]);
            inerArry[i] = inerArry[i].indexOf("</tr>") >= 0 ? inerArry[i] : (inerArry[i] + "</tr>");
        }
        tbody.innerHTML = inerArry.join('');
    }

</script>

</body>
</html>